Brocade SCSI Detailed : http://www.fujitsu.com/downloads/STRSYS/switch/FOS_CmdRef_v730.pdf
Windows Service Stack Basics : https://superuser.com/questions/1096947/what-is-the-servicing-stack-and-how-does-it-work

http://vmwarediary.com/Tips/2017/8/5799801/Vmware-Tools64-msi-missing-during-uninstallation-and-Setup-exe-c-switch-does-not-work
https://www.weforum.org/agenda/2016/01/the-10-skills-you-need-to-thrive-in-the-fourth-industrial-revolution/
https://www.weforum.org/agenda/2018/06/the-3-skill-sets-workers-need-to-develop-between-now-and-2030/

qprocess
net stats server/workstation (Queries Server or Workstation service from services.msc)
sfc /scannow
vssadmin list writers/providers

wevtutil query-events System /count:3 /rd:true /format:text /q:"Event[System[(EventID=6005)]]"

•	List Permissions of current directory and all subdirectories.
dir /s | icacls * /c /t > C:\temp\Perms.xls 
Export to xls not txt, else formatting may not make sense.

•	List Paths where “Access was denied” meaning ownership is not with current user and thus query failed
(Long Paths will most likely fail; Full path shown since /b has been included)
dir /b /s | icacls . /verify /c /t | findstr -i Access (use as suffix > C:\temp\Perms_Denied.xls (or txt since these are one liners) if you want to export it)

WSUS Client
wuauclt /detectnow
wuauclt /reportnow

Delprof
DelProf2.exe /i /u /ed:Administrator /c:Hostname

Reg Query HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall /S /v DisplayName

SYDI Wrapper
cscript.exe sydi-server.vbs -ex -sh -o""C:\temp\DC1.xml -t.""

quser /server <IP>
logoff <session number> /server <IP>

get-vm | Get-HardDisk | where {$_.Persistence -eq "IndependentPersistent"}

dcdiag /c /e /v /q

Reload Perf Counters : lodctr /r
List Available Counters : typeperf -qx
Disable Disk Perf : diskperf -N
Enable Disk Perf : diskperf -Y

fsutil fsinfo ntfsinfo <drive letter>
repadmin /showrepl /errorsonly
repadmin /syncall /APed

tasklist /svc : List Processes along with their Service Name (if any)
tasklist /FI "STATUS eq running" : Find all running Processes
Add /FO List to get list format in output
setspn -a http//
setspn -x -f (x for 'any', f for 'search forest', q for 'query specific')

net use		: To view all Shared Drives
net view \\HOST	: To list all shares

dsquery server -o rdn	: List all DCs in Domain
netdom query fsmo	: FSMO Role Holders

PSEXEC.EXE @serverslist.txt NET LOCALGROUP "Guests" "anonymous" /DELETE
PSEXEC.EXE @serverslist.txt NET LOCALGROUP "Users" "anonymous" /ADD

set devmgr_show_nonpresent_devices=1
devmgmt.msc

esxcli storage nmp satp rule list | grep "3PARdata"
esxcli storage nmp satp rule add -s "VMW_SATP_ALUA" -P "VMW_PSP_RR" -O "iops=1" -c "tpgs_on" -V "3PARdata" -M "VV" -e "HPE 3PAR Custom Rule"

reg load HKU\<username> C:\Users\<username>\ntuser.dat
wuauclt /detectnow
wuauclt /reportnow

esxtop -b -d 2 -n 300 > /esxtopoutput.csv (2 secs is minimum for d, if set to 1 then it auto changes to 2) > Can open in Perfmon
esxcli storage core device set --state=off -d naa.60002ac000000000000001e000015048
esxcli storage core device detached list | grep -i naa.60002ac0000000000000003b00015048
find /vmfs/volumes -name *.[i,I][s,S][o,O]

vmfsfilelockinfo -p xxxx-flat.vmdk

runas /profile /user:administrator “Driver:\folder\program”

esxcfg-nics -l
esxcli network nic up -n vmnic10
esxcli network nic get -n vmnic10

Get-VM | Get-HardDisk | where {$_.Persistence -eq "IndependentPersistent"}
Get-Cluster ClusterName | Get-VMhost | Get-VMHostHBA -Type FibreChannel | Select VMHost,Device,@{N="WWN";E={"{0:X}" -f $_.NodeWorldWideName}}
Get-Cluster ClusterName | Get-VMhost | Get-VMHostHBA -Type FibreChannel | Select VMHost,Device,@{N="WWN";E={"{0:X}" -f $_.PortWorldWideName}}
Get-VM | Select Name, @{N="Datastore";E={[string]::Join(',',(Get-Datastore -Id $_.DatastoreIdList | Select -ExpandProperty Name))}}, @{N="Folder";E={$_.Folder.Name}}  | ogv
Get-VMHost | Select-Object -Property Name,LicenseKey | Out-Gridview
Get-VMHost | Get-VMHostStorage -RescanAllHBA
Get-VMHost |Sort Name|Select Name, @{N=“NTPServer“;E={$_ |Get-VMHostNtpServer}}, @{N=“ServiceRunning“;E={(Get-VmHostService -VMHost $_ |Where-Object {$_.key-eq “ntpd“}).Running}} | Out-Gridview
foreach($esxcli in get-vmhost|get-esxcli){""|select @{n='Time';e={$esxcli.system.time.get()}},@{n='hostname';e={$esxcli.system.hostname.get().hostname}} }
Get-VM | Get-Snapshot | Select VM,Name,Description,@{Label="Size";Expression={"{0:N2} GB" -f ($_.SizeGB)}},Created | ogv
(Get-VM | Get-View | Where-Object {$_.Config.MemoryHotAddEnabled -eq "True"}).Name 
Get-VM | Get-CDDrive | Select IsoPath | Out-Gridview
Get-VM | FT Name, @{Label="ISO File"; Expression = { ($_ | Get-CDDrive).ISOPath }} 

Get-VMHost | Format-List
Get-Datastore | Format-List

dir /b /s | icacls . /verify /T /C | findstr -i Access

wf.msc > Windows Firewall (Advanced)

(PowerShell 5.1) Win8.1AndW2K12R2-KB3191564-x64
tar –xvzf build_X_XX.tgz

Search-ADAccount -UsersOnly -AccountInactive -TimeSpan 90 | ?{$_.enabled -eq $true} | %{Get-ADUser $_.ObjectGuid} | select name, givenname, surname | export-csv unusedaccounts.csv -NoTypeInformation

https://www.postgresql.org/ftp/projects/pgFoundry/dbsamples/pagila/
https://www.enterprisedb.com/downloads/postgres-postgresql-downloads#windows
http://www.itflee.com/hacking/resources Paul Hill's Website)
https://www.offensive-security.com/kali-linux-vmware-wirtualbox-image-download/

java.com/en/download/manual.jsp
ftp://ftp.adobe.com/pub/adobe/reader/win > Get exe & msp

DelProf2.exe /i /u /ed:citadmin /c:HOSTNAME

Rescan all HBAs every week.
get-vm | where { $_ | get-cddrive | where { $_.ConnectionState.Connected -eq "true" } } | select Name

Memory Diagnostic : mdsched.exe (Needs restart, immediate or next)

PS for AD Deleted Users:
[datetime]$StartTime = "9/9/2017"
[datetime]$EndTime = "11/1/2017"
Get-ADObject -Filter {(isdeleted -eq $true) -and (name -ne "Deleted Objects")} -includeDeletedObjects -property whenChanged | Where-Object {$_.whenChanged -ge $StartTime -and $_.whenChanged -le $EndTime}

Reg Query HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall /S /v DisplayName

Get-Service * | where{$_.status -eq "Running"} | Out-Gridview
Get-Acl HKCU:\Software\Microsoft\Windows | Format-list

where /R . wmic.xlsx

(Windows Time Service In Depth) https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/windows-time-service/how-the-windows-time-service-works
(MCSA) https://quizlet.com/31470118/msca-70-412-exam-an-flash-cards/

Get-ADUser -Filter * -Properties mail | select sAMAccountName, givenName, surname, userPrincipalName, mail | ogv

cscript.exe sydi-server.vbs -ex -sh -o""C:\temp\DC1.xml -t.""

permit tcp host 192.168.25.17 eq domain host 192.168.29.30
permit udp host 192.168.25.17 eq domain host 192.168.29.30

nltest /dsgetdc: /force
https://blogs.technet.microsoft.com/musings_of_a_technical_tam/2012/02/15/group-policy-basics-part-2-understanding-which-gpos-to-apply/

subst j: . // Create Virtual Drive (non admin cmd)
subst /d j:

search-adaccount -accountinactive -usersonly -timespan "195" | export-csv -path C:\"inactive.csv"

quser /server <IP>
logoff <session number> /server <IP>

get-vm | Get-HardDisk | where {$_.Persistence -eq "IndependentPersistent"}

Get ADID Owner : Get-ADUser -filter * | Select name,@{n="owner";e={(Get-Acl "ad:\$($_.distinguishedname)").owner}} >> AD.txt
Get Object Owner : Get-ADComputer -filter * | Select name,@{n="owner";e={(Get-Acl "ad:\$($_.distinguishedname)").owner}} >> AD.txt

dsget group "DN" -members >> I:\Members.txt

FTP Related : mmc %systemroot%\system32\inetsrv\iis.msc

CACLS TASKS /E /G builtin\administrators:F
dcdiag /c /e /v /q

Reload Perf Counters : lodctr /r
List Available Counters : typeperf -qx
Disable Disk Perf : diskperf -N
Enable Disk Perf : diskperf -Y

wmic sysdriver

netstat -an | findstr LISTENING 
netstat -ano (o for Open)
Get-WmiObject win32_SystemEnclosure -ComputerName <ServerName> | select serialnumber
gwmi win32_ComputerSystem -ComputerName <ServerName> | select OEMStringArray

w32tm /resync
w32tm /tz
w32tm /monitor /domain:TWUTIL.NET (shortcut to find out total number of DCs in Domain)

robocopy \\TRFIWP01\USERS-D\TMORROW \\TDFIWP01\USERS-D\TMORROW /MIR /SEC /L /R:0 /W:0 /LOG+:log.txt

dsquery group -name "group name" | dsget group -members -expand

fsutil fsinfo ntfsinfo <drive letter>
sc GetDisplayName <Service Name> - From Services Tab in Task Manager for Services in sevices.msc
reset session <Session Name | Session ID>
qprocess

repadmin /showrepl /csv >> X.csv
repadmin /showrepl /errorsonly

ntdsutil

psexec.exe -i -s cmd.exe
pskill -t scanner.exe

dir /s *.exe
dir /q \\Path : Lists Owner

msinfo32 or msinfo32.exe

Check Permission :
cacls \\Path
icacls \\Path

DISM.exe /Online /English /Get-Features /Format:Table
DISM /online /Cleanup-Image /SpSuperseded - Clean Winsxs after SP Upgrade

psexec \\ivrdbwp01a net localgroup "Remote Desktop Users" "twutil\RKUMARVG" /add

DISM /Online /Get-Packages : List all installed updates (Elevated CMD)
dism /online /get-packageinfo /packagename:Package_for_KB958488~31bf3856ad364e35~amd64~~6.2.7600.16513

WMIC QFE List for KB#
Pre Win 2003 : QFECHECK /V

KB839803 : ServicesPipeTimeout

For deleting CBS.log kill process TrustedInstaller.

C:\TEMP // FOR /f %a in (Input.txt) DO dsquery user -name %a >> Output.txt

FOR /f %a in (Input.txt) DO net view \\%a >> Output.txt
FOR /f %a in (Input.txt) DO cacls %a >> Output.txt

Install.bat
________________________________________________________________________________________
@ECHO OFF
TITLE MSU Patches Installation
FOR %%i IN ("C:\temp\Patches\*.msu") DO START /WAIT "" WUSA.EXE "%%i" /quiet /norestart
EXIT
________________________________________________________________________________________

tasklist /svc : List Processes along with their Service Name (if any)
tasklist /FI "STATUS eq running" : Find all running Processes
Add /FO List to get list format in output
setspn -a http//
setspn -x -f (x for 'any', f for 'search forest', q for 'query specific')

net use		: To view all Shared Drives
net view \\HOST	: To list all shares

dsquery server -o rdn	: List all DCs in Domain
netdom query fsmo	: FSMO Role Holders

Elevated cmd : net stop "windows update" // Loses effect after session for us due to GP

cd C:\SysInternalSuite\
copy con serverslist.txt <<enter list of servers>> -> Ctrl+Z -> Enter
PSEXEC.EXE @serverslist.txt NET LOCALGROUP "Guests" "USER" /DELETE
PSEXEC.EXE @serverslist.txt NET LOCALGROUP "Users" "USER" /ADD

Routing Table : netstat -r

set devmgr_show_nonpresent_devices=1
devmgmt.msc

https://www.drupal.org/node/31506 : CRON Jobs

schtasks /create /tn "Copy" /sc Minute /mo 3 /tr "D:\Copy.bat
at 13:11 /EVERY:Th Forfiles.exe -p D:\X -m *.txt -c \"Cmd.exe /C del @path\"
at 18:30 /EVERY:M,T,W,Th,F "D:\DD files posting\Debug\ ConsoleApplication8.exe" /Yes

WMIC	: http://betanews.com/2011/01/14/wmic-the-best-command-line-tool-you-ve-never-used/

sfc /scannow 						- System File Checker

regsvr32 Softpub.dll					- Register Mentioned DLL Files (0x800C0005 or 0x8004005)
regsvr32 Wintrust.dll
regsvr32 Initpki.dll

(Unsure) In case it's a 32 bit dll in a 64 bit machine, we have to go ahead and paste in C:\Windows\SysWOW64\ then go there from an elevated cmd and then regsvr32. Reboot required.

In case of explorer.exe failure try,

regsvr32 -u regsys32.dll				- Unregister .dll
regsvr32 regsys32.dll

In 64 bit system,

cd \windows\syswow64
regsvr32 c:\filename.dll

adsiedit.msc

ipconfig /flushdns

driverquery /s Hostname

wmic /Node:Hostname LogicalDisk Where DriveType="3" Get DeviceID,FileSystem,FreeSpace,Size

wmic useraccount get name,sid
wmic useraccount where name='username' get sid
wmic useraccount where (name='administrator' and domain='%userdomain%') get name,sid
wmic service get /format:hform > C:\Services.html
wmic bios get serialnumber
wmic os get osarchitecture

wmic OS get Caption,CSDVersion,OSArchitecture,Version
wmic path win32_physicalmedia get SerialNumber
wmic BIOS get Manufacturer,Name,SMBIOSBIOSVersion,Version
wmic CPU get Name,NumberOfCores,NumberOfLogicalProcessors
wmic MEMPHYSICAL get MaxCapacity
wmic MEMORYCHIP get Capacity,DeviceLocator,PartNumber,Tag
wmic NIC get Description,MACAddress,NetEnabled,Speed
wmic DISKDRIVE get Caption,InterfaceType,Name,Size,Status
wmic USERACCOUNT get Caption,Name,PasswordRequired,Status
wmic path win32_physicalmedia get SerialNumber

gpresult /r

Connect-VIServer -Server <Hostname/IP> -Protocol https -User <Username>



Firewall Commands :

netsh firewall set service type = fileandprint mode = enable
netsh firewall set service type = remoteadmin mode = enable

Citrix:

qfarm HOSTNAME /load
qfarm HOSTNAME /app
qfarm /online
qfarm /offline
qfarm /app


net stop Citrix IMA
dsmaint recreatelhc


// VSS Timeout Issues

Restartnig Services	: https://support.software.dell.com/appassure/kb/129774

// Adjusting Timeout Limit

You can adjust the timeout period in the registry, by adding the DWORD registry key HKLM\SYSTEM\CurrentControlSet\services\VSS\Settings\IdleTimeout, and setting it to the number of seconds you want VSS to wait in an idle state before shutting down. Default is 180 seconds.

If you suspect that VSS shutting down is causing you problems, try setting it to 0xffffffff, which would be about 136 years. See if that helps you any.


// Clean Manager Locations

Windows Server 2008 R2 - 64-bit - C:\Windows\winsxs\amd64_microsoft-windows-cleanmgr_31bf3856ad364e35_6.1.7600.16385_none_c9392808773cd7da\cleanmgr.exe
Windows Server 2008 R2 - 64-bit - C:\Windows\winsxs\amd64_microsoft-windows-cleanmgr.resources_31bf3856ad364e35_6.1.7600.16385_en-us_b9cb6194b257cc63\cleanmgr.exe.mui

%AllUsersProfile%\Application Data\Microsoft\Dr Watson

unhide.bat :

CD\
DIR /AD /S /B

Event ID :

[Security Tab]

627 - Password Change Attempt
628 - Password Changed by Admins
642 - Password Updated

____________________________________________________________________________________________________________________________________________________________________________
vNUMA

In general, the following best practices should be followed regarding vNUMA and Cores per Socket:
•	Configure the VM CPU value equal to Cores per Socket, until you exceed the physical core count of a single physical NUMA node.

Example: for a host with 8-core processors, any VM with 8 (or fewer) CPUs should have the same Cores Per Socket value.
•	When you need to configure more vCPUs than there are physical cores in the NUMA node, evenly divide the vCPU count across the minimum number of NUMA nodes.

Example: for a 4-socket, 8-core host, and the VM needs more than 8 vCPUs, a reasonable choice may include a 16 vCPU VM with 8 Cores per Socket (to match the 8-core processor architecture)
•	Don’t assign an odd number of vCPUs when the size of your virtual machine exceeds a physical NUMA node.

Example: for a 2-socket, 4-core host, do not create a VM with 5 or 7 vCPUs.
•	Don’t exceed the total number of physical cores of your host.

Example: for a 2-socket, 4-core host, do not create a VM with more than 8 vCPUs.
•	Don’t enable vCPU Hot Add. (this disables virtual NUMA)
•	"Right-size" monster VMs to be multiples of physical NUMA size.

Example: on an 8 cores/node system, 8/16/24/32 vCPU; for a 10 cores/node system, 10/20/40 vCPU
There are many Advanced Virtual NUMA Attributes (click for a full list); here are a few guidelines, but in general, the defaults are best:
•	If the VM is larger than total physical core count (e.g. a 64 vCPU VM on a 40 core / 80 thread host), try numa.consolidate = false
•	If Hyper-Threading is enabled (usually the default), numa.vcpu.preferHT=true may help (KB 2003582)
•	If Cores per Socket is too restrictive, you can manually set vNUMA size with numa.vcpu.maxPerMachineNode
•	To enable vNUMA on a VM with 8 or fewer vCPUs, use numa.vcpu.min
____________________________________________________________________________________________________________________________________________________________________________
Quick Query of All MS Patches Installed

Open Notepad. Paste List of Hostnames/FQDNs or IPs and save the file as Input.txt under “C:\Temp\”
## I prefer IP and as a result I have provided that only in Input file instead of Hostnames.

Then start cmd (non admin works) and paste the command below (in blue). Output will come under “C:\Temp\” as QFE_Multiple.txt since that’s configured in my command.
FOR /f %a in (C:\Temp\Input.txt) DO wmic /node:%a qfe list >> C:\Temp\QFE_Multiple.txt

PFA, my Output (QFE_Multiple) & Input files for reference.
In the output file you will find Hostnames too for each patch listed. Per line. Example/Reference below.

Make sure to uncheck Word Wrap in notepad otherwise the Data will appear weird. PFB.
 
Example of the command post execution. Input.txt had only two IPs so it ended after two executions. Remove all spaces from the Input File via Find & Replace.
____________________________________________________________________________________________________________________________________________________________________________
GPTFIX

Note down the Datastore which has GPT error. 
Migrate all VMs from the target Datastore to OK Datasore, check for space issues.
If any server migration issue we need to take approval from Customer and shutdown the VMs. (Confirm for Proper Backup)
After Migration, browse the Datastore and make sure no other running VM available on this DS.
After the Datastore is Free then log in to the Esxi host throuh putty and execute the command.

GPT Fix:
partedUtil getptbl /vmfs/devices/disks/naa.ID of the Datastore

partedUtil fixGpt /vmfs/devices/disks/ naa.ID of the Datastore

partedUtil getptbl /vmfs/devices/disks/ naa.ID of the Datastore - Run again to check if any error occurred.
____________________________________________________________________________________________________________________________________________________________________________
Copying Shares via Registry

Copy-ItemProperty -Path HKLM:\System\CurrentControlSet\Services\LanmanServer\Shares\Security -Destination HKLM:\System\CurrentControlSet\Services\LanmanServer\Backup -name "ShareName" 

If the VM’s disk are not locked by the backup vProxy server then we need to check in the ESXi. 
First, we need to identify in which host specific VM is hosted. Go to the VM on the right-hand side select the summary tab. 
Go to VM edit settings check is there any disk is grayed out. 
For example, if “Hard disk 1” is not grayed out, it is not locked. "Hard disk 2" if greyed out (Size Portion) is locked.

SSH to ESXi. Browse to Datastorw where target VMDK exists.
vmkfstools -D xx-flat.vmdk (Target FLAT) > Note Down MAC which has locked it.

Step 1 > etc/init.d/vpxa restart
If the issue is still not fixed then try restart Hostd service (etc/init.d/hostd  restart) .
Even after restarting the VPXA,  hostd , service if we are still getting the consolidation/disk lock issue.
Try restart Services.sh services wait for all the services to restart then try disk consolidation.
Else isolate & reboot the ESXi.
____________________________________________________________________________________________________________________________________________________________________________
Pre-DR (Manual) Thorough Documentation

vmware -vl
esxcfg-nics -l
vmkload_mod -s elxnet | grep Version
vmkchdev -l | grep vmnic0
esxcli network nic get -n vmnic0
esxcfg-vswitch -l
esxcli network vswitch standard portgroup list
esxcfg-scsidevs -a
vmkload_mod -s lpfc820 | grep Version
esxcli storage vmfs extent list
esxcli storage core device detached list
esxcli storage core device partition list
esxcli storage core adapter list
esxcli storage core adapter stats get
esxcli storage core device list
esxcli software vib list
esxcli storage core claimrule list
esxcli storage core device vaai status get
esxcli storage vmfs lockmode list
____________________________________________________________________________________________________________________________________________________________________________
Provide Hash Dump of the passwords from the AD server for Password Audit

1.)	Login to any one of the Domain Controller

2.)	Open Command prompt in Administrator mode


3.)	Run the below command
ntdsutil
ntdsutil: activate instance ntds
ntdsutil: ifm
ifm: create full D:\AD_Hash
ifm: quit
ntdsutil: quit

4.)	Now that you can able to see two folders created under mentioned path “D:\AD_Hash”
a.	“D:\AD_Hash\Active Directory” (under this folder you would able to see “Ntds.dit” file)
b.	“D:\AD_Hash\Registry” (under this foler you would able to see “Security” and “System” files)

5.)	Copy “Ntds.dit” file and “System” file to a single folder.


6.)	Extract enclosed “NtdsAudit.exe” and run the below command in command prompt.

You can download it from below GitHub as well.
https://github.com/Dionach/NtdsAudit 


NtdsAudit.exe "ntds.dit" -s "SYSTEM" -p pwdump.txt --users-csv users.csv
 
7.)	Now you should able to see “pwddump.txt” and “users.csv” files 
8.)	Open “pwddump.txt” and copy the content to excel. Clean up the data using “Text to Columns” option and provide the report.
____________________________________________________________________________________________________________________________________________________________________________

Utility URLs.

VMware Downloads	https://my.vmware.com/web/vmware/downloads
VMware Account Logon	https://my.myvmware.com
VMware Support	https://my.vmware.com/support
Vmware Support Details (Production)	https://www.vmware.com/support/services/production.html
VMware Verion Update Reference	https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1014508
vSphere Version Update Reference	https://kb.vmware.com/selfservice/search.do?cmd=displayKC&docType=kc&docTypeID=DT_KB_1_1&externalId=2143838


Other URLs.
https://www.google.com/search?q=ESXI+SAB+boot+host+updated%2Bupdate+manager&source=lnms&tbm=isch&sa=X&ved=0ahUKEwj6oI3N4cfaAhUFTI8KHXhdBt4Q_AUICygC&biw=1366&bih=654#imgrc=4jMmQuQpJWUEPM:
https://docs.vmware.com/en/VMware-vSphere/6.0/com.vmware.vsphere.update_manager.doc/GUID-90AA4FDB-B29B-4F7F-A400-38EFC4110024.html
https://www.vladan.fr/how-to-upgrade-a-esxi-6-0-to-esxi-6-5-via-vmware-update-manager/

____________________________________________________________________________________________________________________________________________________________________________
Get-LockedOutLocation.ps1

#Requires -Version 3.0
<#
.SYNOPSIS
    Get-LockedOutUser.ps1 returns a list of users who were locked out in Active Directory.
.DESCRIPTION
    Get-LockedOutUser.ps1 is an advanced script that returns a list of users who were locked out in Active Directory
by querying the event logs on the PDC emulator in the domain.
.PARAMETER UserName
    The userid of the specific user you are looking for lockouts for. The default is all locked out users.
.PARAMETER StartTime
    The datetime to start searching from. The default is all datetimes that exist in the event logs.
.EXAMPLE
    Get-LockedOutUser.ps1
.EXAMPLE
    Get-LockedOutUser.ps1 -UserName 'mikefrobbins'
.EXAMPLE
    Get-LockedOutUser.ps1 -StartTime (Get-Date).AddDays(-1)
.EXAMPLE
    Get-LockedOutUser.ps1 -UserName 'mikefrobbins' -StartTime (Get-Date).AddDays(-1)
#>
[CmdletBinding()]
param (
    [ValidateNotNullOrEmpty()]
    [string]$DomainName = $env:USERDOMAIN,
    [ValidateNotNullOrEmpty()]
    [string]$UserName = "*",
    [ValidateNotNullOrEmpty()]
    [datetime]$StartTime = (Get-Date).AddDays(-3)
)
Invoke-Command -ComputerName (
    [System.DirectoryServices.ActiveDirectory.Domain]::GetDomain((
        New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext('Domain', $DomainName))
    ).PdcRoleOwner.name
) {
    Get-WinEvent -FilterHashtable @{LogName='Security';Id=4740;StartTime=$Using:StartTime} |
    Where-Object {$_.Properties[0].Value -like "$Using:UserName"} |
    Select-Object -Property TimeCreated,
        @{Label='UserName';Expression={$_.Properties[0].Value}},
        @{Label='ClientName';Expression={$_.Properties[1].Value}}
} -Credential (Get-Credential) |
Select-Object -Property TimeCreated, UserName, ClientName
____________________________________________________________________________________________________________________________________________________________________________
VMware DHC
Prerequisite : Latest PowerCLI & PowerShell installed. Elaborated for L1s.

First log on to vSphere Client and check HA-DRS settings, mainly DRS.
Next check for ANY alert on the vCenter level in the hierarchy (LHS), make sure you understand all of those and in case something is a threat, get it nullified.
If you get alert for Memory on a VM, make sure you set Graph Options to Active% + Consumed + Balloon in the Performance Tab to get an idea of the actual Memory Health.
No VMs in Production should Balloon, this means that real RAM is out of capacity.

Start PowerCLI then Connect-VIServer -Server {vCenter Server IP}
Try to get the latest version installed.
Tip : You can connect multiple vCenter Servers in parallel to get a consolidated workspace.

Get-VMHost | Out-Gridview
Out-Gridview allows you to Copy Data from selected rows and / or Sort Columns on the go.
In recent versions, we can use ogv as well as a shortcut else in older versions we have to create that alias first.

 
Example of checking ESXi Host Service Status with refresh.
Get-VMHostService -Host {ESXi Host IP} -Refresh

 
Any of these services can be started via vSphere GUI. Select ESXi Host > Configuration > Security Profile > (Services) Properties > Select Required Servcie > Options > Start or Stop.

 
Command to get Independent Persistent VMDKs  (Virtual Disks for Vitual Machines). Direct SAN Mapped LUNs specially for Windows Clusters have this setting but any VM having a locally defined Disk file has a catch.
When taking a snapshot, VMware ignores Independent Disks. That is why the following command is important.
There’s also an Independent Nonpersistent but Snapshotting those makes no sense because Nonpersistent configuration makes data volatile on that disk and every time that parent VM is powered off, the data is erased.

Get-VM | Get-HardDisk | where {$_.Persistence -eq "IndependentPersistent"} | Out-Gridview

Example of output. And the Datastore is mentioned in [ ] as well.
 

Generate List of Current Snapshots.
Get-VM | Get-Snapshot | Select VM,Name,Description,@{Label="Size";Expression={"{0:N2} GB" -f ($_.SizeGB)}},Created
You can pipe output through Gridview to get a more manageable dataset.

 
Get ESXi Host Current Time. Extremely important as this is part of the chain of Domain NTP and in case time goes offset by the limit defined in Default Domain Policy, then auth to components will fail.
Some VMs will get their time updated via VMware Tools.
foreach($esxcli in get-vmhost|get-esxcli){""|select @{n='Time';e={$esxcli.system.time.get()}},@{n='hostname';e={$esxcli.system.hostname.get().hostname}} }

 
This command is GOLD : Get-VMHost | Get-VMHostStorage -RescanAllHBA or you can right click on an Host Cluster and hit Rescan All Datastores (HBAs and Vloumes both)
Rescanning HBA is a necessity on so many occasions eg. When a new LUN is added, once a week, after a storage activity, etc.
Without rescanning HBA a lot of Storage might remain unmanageable / invisible.
Warning : Not to be run immediately before an activity because when HBAs are scanned, some Disaster Scale Features like vMotion are halted. Not to be run when vMotion(s) are taking place.
Scroll up and down the Tasks Pane, checking thoroughly of anything In Progress before executing this.


This is my Custom Script to check DS Status in seconds and get more details than the overhyped RV Tools Report. I shared this with TSG too.
This is one of the MUST checks. Forget alerting, etc. One cannot take this for granted EVER.
________________________________________
$GDS = Get-Datastore
$table = @()
foreach ($ds in $GDS) {
$dsview = $ds | Get-View
$thisDS = "" | Select "DatastoreName","CanonicalName","OverallStatus","TotalSpaceTB","TotalSpaceGB","FreeSpaceGB"
$thisDS."DatastoreName" = $ds.Name
$thisDS."CanonicalName" = $dsview.info.vmfs.extent
$thisDS."OverallStatus" = $dsview.OverallStatus
$thisDS."TotalSpaceTB" = $ds.CapacityGB/1024
$thisDS."TotalSpaceGB" = $ds.CapacityGB
$thisDS."FreeSpaceGB" = $ds.FreeSpaceGB
$table += $thisDS
}
$table | Out-Gridview 
________________________________________
Output (see how useful it is) :

This is to get any ISOs mounted to any VM. Not unmounting after activity may lead to issues during vMotion, thus affecting Recovery in case of a Host Level Incident.
Get-VM | FT Name, @{Label="ISO File"; Expression = { ($_ | Get-CDDrive).ISOPath }} 

This is to get a list of the Licenses currently in use.
Get-VMHost | Select-Object -Property Name,LicenseKey | Out-Gridview
____________________________________________________________________________________________________________________________________________________________________________

Random CLI

Run > msinfo32 Check which values you can use from the output.
Get current list of features installed in server : DISM.exe /Online /English /Get-Features /Format:Table
Get list of psexec \\Hostname net localgroup "Administrators"

Get full path as output for all files from current directory (.) : dir /s /b
Search all SPNs in Forest : setspn -x -f (make sure to mark out duplicates from the output)
Get all DCs in Domain : dsquery server -o rdn
Get all GCs in Domain : dsquery server -o rdn -isgc
Time Sync and backdoor check of count of DCs : w32tm /monitor (Wipro has blocked this function recently, the GetDCList call fails).
Get Time Zone : w32tm /tz
Get Block Size : fsutil fsinfo ntfsinfo <drive letter>
Get all ADCS Servers : certutil.exe
Get all Shared Objects (Drives, Printers, etc) : net view \\Hostname
Get H/W Serial Number : wmic bios get serialnumber
Get HDD Serial Number : wmic path win32_physicalmedia get SerialNumber (Running on VMs give weird values based off Datastore naa IDs)
Inactive ADIDs (90 Days) : Search-ADAccount -UsersOnly -AccountInactive -TimeSpan 90 | ?{$_.enabled -eq $true} | %{Get-ADUser $_.ObjectGuid} | select name, givenname, surname | export-csv unusedaccounts.csv -NoTypeInformation
Get list of installed Apps : Reg Query \\Hostname\HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall /S /v DisplayName
Get all installed patches : wmic qfe list
Get all Detailed Services Stats in HTML Report : wmic service get /format:hform > C:\Services.html
____________________________________________________________________________________________________________________________________________________________________________
Get HBA Firmware Version (Windows), Powershell, Local :
$WMI = Get-WmiObject -class MSFC_FCAdapterHBAAttributes -namespace "root\WMI" -computername localhost 
$WMI.FirmwareVersion
____________________________________________________________________________________________________________________________________________________________________________

Citrix 7.x

PVS Checker for Citrix : https://support.citrix.com/article/CTX217122
Eg Error : No DHCP Offers Received after Legacy BIOS Test (not BDM Test)

Monitor Licenses, Registration & Maintenance at all times.

If Licenses are fully utilized then no new connections will be accepted.
If an instance is Unregistered, it will not accept any connections.
If an instance in Under Maintenance, it will not accept any new connections.


Case 1 : Desktop Apps are laggy.

1.	Log on to Citrix Studio and get an idea of the servers which are hosting the said service(s), if you find a lot of disconnected sessions in that Delivery Group then log them off, might resolve the issue.
2.	Check for Machine Failures from Citrix Director. Log on with local admin and try restarting Citrix Profile Service in case you see a lot of (–) registered under ADID pane when you check connections for a specific server.
3.	Individually log on to those servers and check,
a. Last Boot Time (net stats workstation)
> In case one or more weren’t rebooted within the last 10 days and were over utilized dynamically then resource leakage is probably the root cause. Might need a reboot.
b. Memory & CPU Utilization via Task Manager (Ctrl + Shift + Esc)
> See which users are utilizing more Memory / CPU. To perform a light audit, log on to Director and search by Username then check the Application Headers being used.
4.	Log on to Director, search one or more of the ADIDs facing the issue then click on Details on the top right corner and focus on how much latency the user is facing (ms = milliseconds).
 
Can be a local network issue or can be an issue with AWS since Citrix 7.6 is hosted on it. Ask both parties to check.


Case 2 : Can authenticate to https://citrix.xxx.com/Citrix/xxx/ but cannot launch anything afterwards.

1.	Check Studio for the user’s ADID in “sessions”. If you find any session (specially disconnected), log it off and ask user to try again.
2.	Ask user’s credentials and use them on your computer (Open Incognito to allow a separate logon in the same browser), then log on and try to launch the Desktop that user is failing to launch.
If Desktop is launching just fine then,
a. User needs to uninstall and reinstall receiver on local machine.
b. In case of some users when they work from home, they may have to disable forced-proxy related software from System Tray.
If Desktop is not launching for you too,
a. Check if the correct group has been added to the User’s ADID.
b. Identify the current corrupted session (sometimes notified as a – in Studio), then temporarily put that server in Maintenance Mode and ask the user to log on again. If the analysis was correct then the user will be able to log on to another instance under the same delivery group successfully since that one should not be having a stale profile. Once user has logged on, pull the instance out of Maintenance Mode immediately as LB will not occur on that if it stays under maintenance.


Case 3 : Application (Outlook / Skype / XYZ not working)

A profile reset solves this issue 90% of times but user has to be notified in case you are performing one.
Steps,
1.	Log off the user.
2.	Search and delete all of the user’s profiles from the instances under target delivery group.
3.	Then ask the user to make a note of all the shared drives currently mapped because they will be gone after the rest. In fact user will have to reconfigure all logons, etc.
After that go to \\ProfileServer\User_Profiles\ and rename the profile with his/her ADID or rename it with a .old or .older as suffix. This folder contains the settings mainly for most profiles *
4.	In case you want to perform a 100% profile reset, then ask the user to take a backup of all important files in his/her shared drive, and remove the profile from \\ProfileServer\Redirected\ too.
Redirected contains folders like Desktop, Documents, etc for most users *

* ADIDs with a prefix of admin_ are generally exempt from this and all of their files are located under User_Profiles folder only.

Extra : To view NTUSER.DAT and NTUSER.INI, you will have to allow system folders to be visible else you can run attrib *.* -a -h -r -s on required directory’s explorer pane (shortcut, PFB).
Even typing cmd there directly opens command prompt in that directory.


Case 4 : URL not working and it is not a certificate issue.

1. Check if it’s working from your end to make sure there are no DNS issues.
2. Ask user to access web browser, then Ctrl + Shift + Delete > Everything > Since Beginning of Time.
3. Check local Root Cert Store and verify if the root cert is present under Trusted Root Certificates (mmc > Certificates).

Best Practices : Remove stale profiles via Delprof (Biweekly or once a week). Pair woth GPO to force logoff dc'ed Sessions.
Check Paging to ensure Memory availability.

____________________________________________________________________________________________________________________________________________________________________________

PS : Remote Config Windows NIC.

New-PSSession -ComputerName 10.10.10.10
Enter-PSSession -ComputerName 10.10.10.10

Get-NetAdapter
Get-NetAdapter -Name "Ethernet1" | Rename-NetAdapter -NewName "OSManagement" -PassThru

Get-NetAdapter -Name OSManagement | Set-NetIPInterface -DHCP Enabled
Get-NetAdapter -Name OSManagement | New-NetIPAddress -IPAddress 10.10.10.11 -PrefixLength 24
Set-DnsClient -InterfaceAlias OSMaanagement -RegisterThisConnectionsAddress 0 #(or 1)
route add 10.10.10.0 MASK 255.255.255.0 10.10.10.1 metric 3 -P
route add 10.11.10.0 MASK 255.255.255.0 10.11.10.1 metric 4 -P
Exit-PSSession 

Route Print   

____________________________________________________________________________________________________________________________________________________________________________

KB URLs

Hitachi Compute Blade 520 B3 Specs
http://www.hitachi.co.jp/products/bladesymphony_global/bs520_hx3.html

Hitachi Compute Blade 500 Datasheet
https://www.hds.com/en-us/pdf/datasheet/hitachi-compute-blade-500-datasheet.pdf

Hitachi Compute Blade 500 Whitepaper
https://www.hds.com/en-us/pdf/white-paper/hitachi-compute-blade-500-whitepaper.pdf

EVC Processor Generation Reference
https://en.wikipedia.org/wiki/List_of_Intel_CPU_microarchitectures

EP EN EX (CPU Architectures)
https://serverfault.com/questions/414940/what-are-en-ep-and-ex-platforms

vPostgres for vSphere 6
http://www.virtually-limitless.com/vsphere-6-0/interacting-with-the-vpostgres-database-in-vsphere-6-0/

PSC 6.0
https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2113115

Subnet Cheat Sheet
https://www.aelius.com/njh/subnet_sheet.html

vSphere 6 Documentation
https://pubs.vmware.com/vsphere-60/index.jsp

Location of VMware Logs (vCenter 6.0)
https://kb.vmware.com/selfservice/search.do?cmd=displayKC&docType=kc&docTypeID=DT_KB_1_1&externalId=2110014

Location of VMware Logs (ESXi 6.0)
http://pubs.vmware.com/vsphere-60/index.jsp?topic=%2Fcom.vmware.vsphere.monitoring.doc%2FGUID-832A2618-6B11-4A28-9672-93296DA931D0.html

Location of VMware Logs (All)
https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1021806

181 Questions and Answers
http://www.aiotestking.com/vmware/which-three-authorization-types-are-valid-in-vsphere/

Documenting VM Environment
https://communities.vmware.com/thread/289481

Intel Xeon E5-2697 v3
http://www.cpu-world.com/CPUs/Xeon/Intel-Xeon%20E5-2697%20v3.html

Intel Xeon E5-2690 v4
http://www.cpu-world.com/CPUs/Xeon/Intel-Xeon%20E5-2690%20v4.html

Processor VT, BIOS
https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1003944

Rack Mount vs Blade
https://www.tuangru.com/the-pros-and-cons-of-blade-servers-vs-rack-servers/

Clone Best Practices
https://kb.vmware.com/kb/1027865

VM Datastore Diagram
http://www.altaro.com/vmware/wp-content/uploads/2016/04/VMware-Storage.jpg

VMware EVO
https://blogs.vmware.com/virtualblocks/2015/10/14/vmware-evo-sddc-an-insiders-view/

Understanding Quorum
https://technet.microsoft.com/en-us/library/cc731739(v=ws.11).aspx#BKMK_choices

Why Reboot?
http://exodusdev.com/products/whyreboot

Resource Pools
http://wahlnetwork.com/2012/02/01/understanding-resource-pools-in-vmware-vsphere/

Resource Pools
http://www.settlersoman.com/vmware-vsphere-basics-understanding-resource-pools/

HA Admission Control
http://www.settlersoman.com/understanding-vmware-ha-admission-control/

ESX Resource Management PDF
https://www.vmware.com/pdf/esx_resource_mgmt.pdf

vCenter Resource Management PDF
http://pubs.vmware.com/vsphere-50/topic/com.vmware.ICbase/PDF/vsphere-esxi-vcenter-server-50-resource-management-guide.pdf

Official Script Pool
http://www.virtu-al.net/

PowerShell Basic Functions
https://blogs.technet.microsoft.com/heyscriptingguy/2014/04/28/basics-of-powershell-looping-foreach/

Backup / Restore vPostgres (Vendor)	https://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&docType=kc&externalId=2091961&sliceId=1&docTypeID=DT_KB_1_1&dialogID=477268715&stateId=1%200%20477278335

VMDK Lock
https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2110152

ESXTOP
http://www.yellow-bricks.com/esxtop/

ESXCLI
https://pubs.vmware.com/vsphere-50/index.jsp#com.vmware.vcli.ref.doc_50/vcli-right.html

Spectre & Meltdown ***
https://kb.vmware.com/s/article/52085
https://kb.vmware.com/s/article/52345
https://www.vmware.com/us/security/advisories/VMSA-2018-0004.html
https://docs.vmware.com/en/VMware-vSphere/6.5/com.vmware.vsphere.security.doc/GUID-832A2618-6B11-4A28-9672-93296DA931D0.html	https://docs.vmware.com/en/VMware-vSphere/6.5/com.vmware.vsphere.security.doc/GUID-832A2618-6B11-4A28-9672-93296DA931D0.html

____________________________________________________________________________________________________________________________________________________________________________

